<div class="flex flex-col gap-4">
  <h1 class="font-bold text-2xl text-center">Gestión de Jugadores</h1>

  <app-find-filter 
    [searchPlaceholder]="'Buscar jugador'" 
    [buttonText]="'Añadir Jugador'"
    (searchTextChange)="filterPlayers($event)"
    (buttonClick)="showAddPlayerModal()"
  />

  @if (playerTeams().length > 0) {
    <section class="w-full flex flex-col gap-2 p-4 border rounded-lg border-grey shadow-[0px_2px_4px_grey]">
      @for (playerTeams of playerTeams(); track playerTeams.player.id) {
        <div class="w-full flex gap-4 items-center">
          <div class="w-[calc(100%-(24px*3)-(16px*3))] flex flex-col gap-1 p-2 border rounded-sm border-grey border-l-4 border-l-primary border-r-4 border-r-primary">
            <span class="font-semibold">{{playerTeams.player.name}} {{playerTeams.player.lastName}}</span>
  
            @let teams = getTeamsStringByPlayerId(playerTeams.player.id!);
            @if (teams) {
              <span class="text-[.875rem] text-[#777] w-full truncate">{{teams}}</span>
            }
          </div>
  
          <div class="flex gap-4">
            <svg class="min-w-fit cursor-pointer" (click)="showEditPlayerModal(playerTeams.player)" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
              <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m5 16l-1 4l4-1L19.586 7.414a2 2 0 0 0 0-2.828l-.172-.172a2 2 0 0 0-2.828 0zM15 6l3 3m-5 11h8"></path>
            </svg>
    
            <svg class="min-w-fit cursor-pointer" (click)="showTeamsModal(playerTeams.player)" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
              <path fill="currentColor" d="M1 17.2q0-.85.438-1.562T2.6 14.55q1.55-.775 3.15-1.162T9 13t3.25.388t3.15 1.162q.725.375 1.163 1.088T17 17.2v.8q0 .825-.587 1.413T15 20H3q-.825 0-1.412-.587T1 18zM21 20h-2.55q.275-.45.413-.962T19 18v-1q0-1.1-.612-2.113T16.65 13.15q1.275.15 2.4.513t2.1.887q.9.5 1.375 1.112T23 17v1q0 .825-.587 1.413T21 20M9 12q-1.65 0-2.825-1.175T5 8t1.175-2.825T9 4t2.825 1.175T13 8t-1.175 2.825T9 12m10-4q0 1.65-1.175 2.825T15 12q-.275 0-.7-.062t-.7-.138q.675-.8 1.038-1.775T15 8t-.362-2.025T13.6 4.2q.35-.125.7-.163T15 4q1.65 0 2.825 1.175T19 8M3 18h12v-.8q0-.275-.137-.5t-.363-.35q-1.35-.675-2.725-1.012T9 15t-2.775.338T3.5 16.35q-.225.125-.363.35T3 17.2zm6-8q.825 0 1.413-.587T11 8t-.587-1.412T9 6t-1.412.588T7 8t.588 1.413T9 10m0-2"></path>
            </svg>
  
            <svg class="min-w-fit cursor-pointer" (click)="showDeleteConfirmModal(playerTeams.player.id!)" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
              <path fill="currentColor" d="M7 4a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2h4a1 1 0 1 1 0 2h-1.069l-.867 12.142A2 2 0 0 1 17.069 22H6.93a2 2 0 0 1-1.995-1.858L4.07 8H3a1 1 0 0 1 0-2h4zm2 2h6V4H9zM6.074 8l.857 12H17.07l.857-12zM10 10a1 1 0 0 1 1 1v6a1 1 0 1 1-2 0v-6a1 1 0 0 1 1-1m4 0a1 1 0 0 1 1 1v6a1 1 0 1 1-2 0v-6a1 1 0 0 1 1-1"/>
            </svg>
          </div>
        </div>
      }
    </section>
  }
</div>

@if (openEditModal()) {
  <app-modal
    [closeModal]="closeEditModal()"
    (modalClosed)="modalClosed()"
  >
    <div class="flex flex-col gap-8 justify-center items-center">
      <h3 class="font-semibold text-2xl">{{modalTitle()}}</h3>

      <div class="flex flex-col gap-4">
        <div class="flex gap-4 items-center">
          <label for="name" class="text-start w-24">Nombre</label>
          <input 
            id="name" 
            type="text" 
            class="h-10 p-2 border border-grey rounded-sm" 
            [ngModel]="modalName()" 
            (ngModelChange)="modalName.set($event)"
          >
        </div>
  
        <div class="flex gap-4 items-center">
          <label for="lastName" class="text-start w-24">Apellidos</label>
          <input 
            id="lastName" 
            type="text" 
            class="h-10 p-2 border border-grey rounded-sm" 
            [ngModel]="modalLastName()" 
            (ngModelChange)="modalLastName.set($event)"
          >
        </div>
      </div>

      <div class="flex gap-4">
        <app-button
          [text]="'Cancelar'"
          [width]="'sm'"
          [color]="'cancel'"
          (click)="closeEditModal.set(true)"
        />
        
        @if (modalType() === 'add') {
          <app-button
            [text]="'Crear'"
            [width]="'sm'"
            (click)="addUser()"
          />
        } @else if (modalType() === 'edit') {
          <app-button
            [text]="'Modificar'"
            [width]="'sm'"
            (click)="editUser()"
          />
        }
      </div>
    </div>
  </app-modal>
}

@if (openTeamsModal()) {
  <app-modal
    [closeModal]="closeTeamsModal()"
    (modalClosed)="teamsModalClosed()"
  >
    <div class="flex flex-col gap-8 justify-center items-center">
      <h3 class="font-semibold text-2xl">{{selectedPlayerTeams()?.player?.name}} {{selectedPlayerTeams()?.player?.lastName}}</h3>

      <div class="grid grid-cols-2 gap-x-8 gap-y-4">
        @for (team of teamManager.allTeams(); track team.id) {
          <div class="w-40 flex gap-2 items-center">
            <input id="{{team.id}}" type="checkbox" [checked]="isSelectedTeam(team.id!)" (click)="teamSelected(team)" class="min-w-6 min-h-6">
            <label for="{{team.id}}" class="max-w-full truncate">{{team.name}}</label>
          </div>
        }
      </div>

      <div class="flex gap-4">
        <app-button
          [text]="'Cancelar'"
          [width]="'sm'"
          [color]="'cancel'"
          (click)="cancelTeamsModal()"
        />

        <app-button
         [text]="'Guardar'"
         [width]="'sm'"
         (click)="saveTeams()"
        />
      </div>
    </div>
  </app-modal>
}

@if (openDeleteModal()) {
  <app-confirm-modal 
    [text]="deleteModalText()"
    [title]="'Eliminar Jugador'"
    [buttonColor]="'red'"
    (selectedOption)="confirmOptionSelected($event)"
    (closedModal)="openDeleteModal.set(false)"
  />
}
